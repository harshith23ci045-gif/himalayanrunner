<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Treks ‚Äì Himalayan Runners</title>

  <link rel="stylesheet" href="/css/treks.css" />
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>

    <!-- CATEGORY BAR -->
    <section class="category-bar">
        <button class="cat active">Himalayan Treks</button>
        <button class="cat">Sunrise Treks</button>
        <button class="cat">Monsoon Treks</button>
        <button class="cat">Yatra</button>
        <button class="cat">Backpacking</button>
    </section>

    <!-- TREK GRID -->
    <main class="trek-grid" id="trekList"></main>

<script type="module">
import { supabase } from "./js/supabase-client.js";
import { listTreks } from "./js/trek-handler.js";

function safe(v, fallback = "") {
    return v === null || v === undefined ? fallback : v;
}

async function loadTreks() {
    const { data, error } = await listTreks();

    if (error) {
        document.getElementById("trekList").innerHTML = "Error loading treks.";
        console.error(error);
        return;
    }

    if (!data || data.length === 0) {
        document.getElementById("trekList").innerHTML = "No treks available.";
        return;
    }

    document.getElementById("trekList").innerHTML = data.map(t => {
        const image = safe(t.image_url, "/images/default.jpg");
        const title = safe(t.title, "Untitled Trek");
        const desc = safe(t.description, "");
        const price = safe(t.amount, "0");
        const oldPrice = t.old_price ? `<span class="old-price">‚Çπ${t.old_price}</span>` : "";

        const days = safe(t.days, "5 days");
        const difficulty = safe(t.difficulty, "Easy");
        const region = safe(t.region, "HIMALAYAN");
        const nextDate = safe(t.next_date, "Soon");

        return `
        <div class="trek-card">
            
            <div class="img-wrap">
                <img src="${image}" alt="${title}" />
                <span class="badge">Himalayan-treks</span>
            </div>

            <div class="content">
                <h3>${title}</h3>

                <div class="meta-row">
                    <span>üìç ${region}</span>
                    <span>üïí ${days}</span>
                </div>

                <div class="meta-row">
                    <span>‚ñ≤ ${difficulty}</span>
                    <span>üìÖ Next: ${nextDate}</span>
                </div>

                <p class="desc">${desc}</p>

                <div class="price-row">
                    <span class="price">‚Çπ${price}</span>
                    ${oldPrice}
                    <span class="arrow">‚Üí</span>
                </div>
            </div>

        </div>
        `;
    }).join("");
