<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Forgot Password - Himalayan Runners</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container" style="padding-top:4rem;">
        <div class="glass-card" style="max-width:480px;margin:0 auto;">
            <h2 class="mb-2 text-center">Forgot Password</h2>
            <p class="mb-2">Enter your email address or mobile number. We'll send a password reset link to both your email and mobile.</p>
            <form id="forgotForm">
                <div class="form-group">
                    <label class="form-label">Email or Phone</label>
                    <input name="identifier" type="text" class="form-input" placeholder="you@example.com or 9999999999" required>
                </div>
                <button class="btn btn-primary" style="width:100%;">Send Reset Link</button>
            </form>
            <p class="mt-2 text-center"><a href="login.html">Back to Login</a></p>
            <div id="result" style="margin-top:12px"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/db.js"></script>
    <script src="js/auth.js"></script>
    <script>
        function showAppMessage(msg) {
            const el = document.getElementById('result');
            el.innerText = msg;
        }

        document.getElementById('forgotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const identifier = e.target.identifier.value.trim();
            const res = await Auth.requestPasswordReset(identifier);
                if (res.success) {
                    const el = document.getElementById('result');
                    el.innerHTML = '<div style="color:green;">' + res.message + '</div>';

                    // If the response includes a demo link (fallback/local flow), show it.
                    if (res.link) {
                        const demo = document.createElement('div');
                        demo.style.marginTop = '8px';
                        demo.innerHTML = '<small>Demo reset link (click to use): <a href="' + res.link + '">' + res.link + '</a></small>';
                        el.appendChild(demo);
                    } else if (res.via === 'supabase') {
                        const hint = document.createElement('div');
                        hint.style.marginTop = '8px';
                        hint.innerHTML = '<small>If you do not receive the email within a few minutes, check your spam folder or try again. For local demo fallback, the reset link will be displayed here.</small>';
                        el.appendChild(hint);
                    }
            } else {
                document.getElementById('result').innerHTML = '<div style="color:red;">' + res.error + '</div>';
            }
        });
    </script>
</body>
</html>
