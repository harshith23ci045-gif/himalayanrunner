<script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
        "YOUR_SUPABASE_URL",
        "YOUR_SUPABASE_ANON_KEY"
    );

    const status = document.getElementById('status');
    const form = document.getElementById('resetForm');

    function show(msg, err = false) {
        status.innerHTML = `<div style="color:${err ? 'red' : 'green'}">${msg}</div>`;
    }
//hi
    // Read ?code= from URL
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    if (!code) {
        show("No token provided.", true);
    } else {
        // Exchange code for session
        const { data, error } = await supabase.auth.exchangeCodeForSession(code);

        if (error) {
            show("Invalid or expired token.", true);
        } else {
            form.style.display = "block";
        }
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const pw = e.target.password.value;
        const confirm = e.target.confirm.value;

        if (pw !== confirm) {
            show("Passwords do not match.", true);
            return;
        }

        const { error } = await supabase.auth.updateUser({ password: pw });

        if (error) {
            show(error.message, true);
        } else {
            show("Password updated successfully!");
            form.style.display = "none";
        }
    });
</script>
